<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDTA - URL Scanner</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#7b2626;
  --card:#6e2a2a;
  --safe:#2ecc71;
  --danger:#ff4c4c;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Montserrat,sans-serif;
  background:linear-gradient(135deg,#0f172a,#020617);
  color:#e5e7eb;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 40px;
}
.logout{
  padding:10px 18px;
  background:rgba(255,255,255,0.15);
  border-radius:30px;
  color:white;
  font-weight:700;
  border:none;
  cursor:pointer;
}
.card{
  background:var(--card);
  padding:30px;
  border-radius:20px;
  max-width:700px;
  margin:30px auto;
  text-align:center;
}
input{
  width:80%;
  padding:14px;
  border-radius:25px;
  border:none;
}
button.scan{
  margin-top:15px;
  padding:12px 30px;
  border-radius:25px;
  background:#ff4c4c;
  border:none;
  color:white;
  font-weight:700;
  cursor:pointer;
}
.result{margin-top:25px;padding:20px;border-radius:15px}
.safe{background:#d9fbe3;color:#145a32}
.danger{background:#fde2e2;color:#7b241c}

/* SUMMARY MODAL */
#summaryModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  z-index:10000;
  align-items:center;
  justify-content:center;
}
#summaryBox{
  background:var(--card);
  padding:25px;
  border-radius:20px;
  width:90%;
  max-width:900px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  padding:8px;
  border:1px solid #333;
}
th{background:#7b2626}
footer{text-align:center;margin:40px}
.back-btn{
  display:inline-block;
  margin-top:15px;
  padding:8px 15px;
  background:#3f2b2b;
  border-radius:25px;
  color:white;
  text-decoration:none;
}
</style>
</head>

<body>

<header>
  <h1>URL Scanner</h1>
  <button class="logout" type="button" onclick="location.href='/logout'">Logout</button>
</header>

<div class="card">
  <form method="POST" action="/scan_url" onsubmit="return startScan()">
    <input name="url_input" placeholder="Enter website URL" required>
    <br>
    <button class="scan" type="submit">Scan URL</button>
  </form>

  {% if result %}
  <div class="result {{ result }}">
    <h3>{{ result|upper }}</h3>
    <p>{{ scanned_url }}</p>

    {% if result == 'safe' %}
    <a href="{{ scanned_url }}" target="_blank">
      <button class="scan" type="button">üåê Visit Website</button>
    </a>
    {% endif %}

    {% if result == 'suspicious' and reasons %}
    <div class="danger" style="margin-top:15px;text-align:left">
      <h4>‚ö†Ô∏è Why this URL is suspicious:</h4>
      <ul>
        {% for r in reasons %}
          <li>{{ r }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- Back to Home -->
  <div style="text-align:center;margin-top:30px;">
    <a href="/home" class="back-btn">‚¨Ö Back to Home</a>
  </div>
</div>

<footer>
  <button type="button" class="scan" onclick="openSummary()">üìä View Detection Summary</button>
</footer>

<!-- SUMMARY MODAL -->
<div id="summaryModal">
  <div id="summaryBox">
    <h2 style="text-align:center">Detection Summary</h2>

    <table>
      <tr>
        <th>#</th>
        <th>URL</th>
        <th>Status</th>
      </tr>
      {% for item in history %}
      <tr>
        <td>{{ loop.index }}</td>
        <td style="word-break:break-all">{{ item.url }}</td>
        <td class="{{ item.status }}">
          {{ item.status|upper }}
        </td>
      </tr>
      {% endfor %}
    </table>

    <div style="text-align:center;margin-top:15px;">
      <form method="POST" action="/export_pdf" style="display:inline;">
        <button class="scan" type="submit">üìÑ Export as PDF</button>
      </form>
      <button type="button" class="scan" onclick="closeSummary()">Close</button>
    </div>
  </div>
</div>

<script>
function openSummary(){
  document.getElementById("summaryModal").style.display="flex";
}
function closeSummary(){
  document.getElementById("summaryModal").style.display="none";
}
</script>
<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loading">
  <div class="loading-box">
    <div class="magnifier">üîç</div>
    <p id="step">Analyzing URL‚Ä¶</p>
    <div class="progress"><div class="bar" id="bar"></div></div>
  </div>
</div>

<style>
.loading-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.loading-box{
  background:white;
  color:#222;
  padding:30px;
  border-radius:20px;
  width:320px;
  text-align:center;
}
.magnifier{
  font-size:45px;
  animation:move 1.5s infinite linear;
}
@keyframes move{
  0%{transform:translateX(-20px)}
  50%{transform:translateX(20px)}
  100%{transform:translateX(-20px)}
}
.progress{
  width:100%;
  height:10px;
  background:#eee;
  border-radius:10px;
  overflow:hidden;
  margin-top:15px;
}
.bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ff4c4c,#ff9f1c);
  transition:width .4s ease;
}
</style>

<script>
let unlocked=false;
function startScan(){
  const overlay=document.getElementById("loading");
  const bar=document.getElementById("bar");
  const step=document.getElementById("step");
  overlay.style.display="flex";

  const steps=[
    "Analyzing URL‚Ä¶",
    "Checking DNS‚Ä¶",
    "Inspecting redirects‚Ä¶",
    "Detecting phishing‚Ä¶",
    "Finalizing‚Ä¶"
  ];

  let i=0;
  const int=setInterval(()=>{
    step.textContent=steps[i%steps.length];
    bar.style.width=(i+1)*20+"%";
    i++;
  },600);

  // Unlock siren / audio only once
  if(!unlocked){
    const s=document.getElementById("siren");
    s.play().catch(()=>{});
    s.pause();
    unlocked=true;
  }

  // Submit form after animation
  setTimeout(()=>{
    clearInterval(int);
    document.forms[0].submit();
  }, 3000);

  return false;
}
</script>

<audio id="siren">
  <source src="/static/loud.mp3" type="audio/mpeg">
</audio>

</body>
</html>
