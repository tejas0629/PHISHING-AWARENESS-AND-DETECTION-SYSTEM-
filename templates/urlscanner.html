<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDTA - URL Scanner</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#7b2626;
  --card:#6e2a2a;
  --safe:#2ecc71;
  --danger:#ff4c4c;
}
*{box-sizing:border-box}
body{
   margin:0;
  font-family:Montserrat,sans-serif;
  background:linear-gradient(135deg,#0f172a,#020617);
  color:#e5e7eb;

}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 40px;
}
.logout{
  padding:10px 18px;
  background:rgba(255,255,255,0.15);
  border-radius:30px;
  color:white;
  font-weight:700;
  border:none;
  cursor:pointer;
}

/* CARD */
.card{
  background:var(--card);
  padding:30px;
  border-radius:20px;
  max-width:700px;
  margin:30px auto;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}
input{
  width:80%;
  padding:14px;
  border-radius:25px;
  border:none;
  font-size:16px;
}
button.scan{
  margin-top:15px;
  padding:12px 30px;
  border-radius:25px;
  background:#ff4c4c;
  border:none;
  color:white;
  font-weight:700;
  cursor:pointer;
}

/* RESULT */
.result{
  margin-top:25px;
  padding:20px;
  border-radius:15px;
}
.safe{background:#d9fbe3;color:#145a32}
.danger{background:#fde2e2;color:#7b241c}

/* BLINK */
body.blink-safe{animation:blinkGreen 1s 3}
body.blink-danger{animation:blinkRedBlue .6s 4}
@keyframes blinkGreen{
  0%,100%{background:var(--bg)}
  50%{background:#2ecc71}
}
@keyframes blinkRedBlue{
  0%{background:#ff4c4c}
  50%{background:#3498db}
  100%{background:#ff4c4c}
}

/* FULLSCREEN RESULT */
.result-overlay{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:64px;
  font-weight:800;
  z-index:9999;
  animation:fadeOut 4s forwards;
}
.result-overlay.safe{background:rgba(46,204,113,.95)}
.result-overlay.danger{
  background:linear-gradient(45deg,rgba(255,76,76,.95),rgba(52,152,219,.95))
}
@keyframes fadeOut{
  0%,80%{opacity:1}
  100%{opacity:0;visibility:hidden}
}

/* LOADING */
.loading-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9998;
}
.loading-box{
  background:white;
  color:#222;
  padding:30px;
  border-radius:20px;
  width:320px;
  text-align:center;
}
.magnifier{
  font-size:45px;
  animation:move 1.5s infinite linear;
}
@keyframes move{
  0%{transform:translateX(-20px)}
  50%{transform:translateX(20px)}
  100%{transform:translateX(-20px)}
}
.progress{
  width:100%;
  height:10px;
  background:#eee;
  border-radius:10px;
  overflow:hidden;
  margin-top:15px;
}
.bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ff4c4c,#ff9f1c);
  transition:width .4s ease;
}

/* FOOTER */
footer{text-align:center;margin:40px}
.about{
  padding:10px 25px;
  border-radius:25px;
  background:#3f2b2b;
  border:none;
  color:white;
}
</style>
</head>

<body>

<header>
  <h1>URL Scanner</h1>
  <button class="logout" onclick="location.href='/logout'">Logout</button>
</header>

<div class="card">
<form method="POST" action="/scan_url" onsubmit="return startScan()">

  <input name="url_input" placeholder="Enter website URL" required>
  <br>
  <button class="scan">Scan URL</button>
</form>

{% if result %}
<div class="result {{ result }}">
  <h3>{{ result|upper }}</h3>
  <p>{{ scanned_url }}</p>
</div>

{% if result=='safe' %}
<a href="{{ scanned_url }}" target="_blank"><button class="scan">Visit Website</button></a>
{% endif %}
{% endif %}
</div>

<footer>
<button class="about" onclick="location.href='/aboutus'">About Us</button>
</footer>

{% if result %}
<div class="result-overlay {{ result }}">
  {{ '‚úÖ SAFE' if result=='safe' else '‚ö†Ô∏è SUSPICIOUS' }}
</div>
<script>
document.body.classList.add("blink-{{ result }}");
setTimeout(()=>document.body.classList.remove("blink-{{ result }}"),4000);
</script>
{% endif %}

<div class="loading-overlay" id="loading">
  <div class="loading-box">
    <div class="magnifier">üîç</div>
    <p id="step">Analyzing URL‚Ä¶</p>
    <div class="progress"><div class="bar" id="bar"></div></div>
  </div>
</div>

<audio id="siren">
  <source src="/static/loud.mp3" type="audio/mpeg">
</audio>

<script>
let unlocked=false;
function startScan(){
  const overlay=document.getElementById("loading");
  const bar=document.getElementById("bar");
  const step=document.getElementById("step");
  overlay.style.display="flex";

  const steps=[
    "Analyzing URL‚Ä¶",
    "Checking DNS‚Ä¶",
    "Inspecting redirects‚Ä¶",
    "Detecting phishing‚Ä¶",
    "Finalizing‚Ä¶"
  ];

  let i=0;
  const int=setInterval(()=>{
    step.textContent=steps[i%steps.length];
    bar.style.width=(i+1)*20+"%";
    i++;
  },600);

  if(!unlocked){
    const s=document.getElementById("siren");
    s.play().catch(()=>{});
    s.pause();
    unlocked=true;
  }

  setTimeout(()=>{
    clearInterval(int);
    document.forms[0].submit();
  },3000);

  return false;
}
</script>

{% if result=='suspicious' %}
<script>
const s=document.getElementById("siren");
s.currentTime=0;
s.play().catch(()=>{});
setTimeout(()=>s.pause(),3000);
</script>
{% endif %}
<div style="margin-top: 20px; text-align: center;">
    <a href="/home" class="back-home-btn">‚¨Ö Back to Home</a>
</div>

</body>
</html>
